<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    html, body {
      padding: 0; margin: 0;
      font-size: 0;
    }

    #canvas {
      background: green;
    }

    .actions {
      position: fixed;
      bottom: 0;
      left: 0;
    }

    .actions button {
      display: none;
    }
    .actions > .show {
      display: inline-block;
    }
  </style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="actions" class="actions">
  <button id="eraser" class="show">橡皮擦</button>
  <button id="brush">画笔</button>
</div>


<script>
  const canvas = document.getElementById('canvas')
  const eraser = document.getElementById('eraser')
  const brush = document.getElementById('brush')
  const actions = document.getElementById('actions')
  const context = canvas.getContext('2d')
  let eraserEnabled = false


  autoSetCanvasSize(canvas)

  listenToUser(canvas)

  eraser.onclick = function () {
    eraserEnabled = true
    eraser.classList.remove('show')
    brush.classList.add('show')
  }

  brush.onclick = function () {
    eraserEnabled = false
    brush.classList.remove('show')
    eraser.classList.add('show')
  }


  function listenToUser(canvas) {
    let isUsing = false
    let previousPoint = { x: undefined, y: undefined }

    // 特性检测
    if (document.body.ontouchstart !== undefined) {
      // 触屏设备
      canvas.ontouchstart = function (e) {
        const x = e.touches[0].clientX
        const y = e.touches[0].clientY
        isUsing = true
        if (eraserEnabled) {
          context.clearRect(x - 5, y - 5, 10, 10)
        } else {
          previousPoint = { x, y }
        }
      }

      canvas.ontouchmove = function (e) {
        const x = e.touches[0].clientX
        const y = e.touches[0].clientY
        if (!isUsing) return
        if (eraserEnabled) {
          context.clearRect(x - 5, y - 5, 10, 10)
        } else {
          const currentPoint = { x, y }
          drawLine(previousPoint.x, previousPoint.y, currentPoint.x, currentPoint.y, 5)
          previousPoint = currentPoint
        }
      }

      canvas.ontouchend = function () {
        isUsing = false
      }
    } else {
      // 非触屏设备
      canvas.onmousedown = function (e) {
        const x = e.clientX
        const y = e.clientY
        isUsing = true
        if (eraserEnabled) {
          context.clearRect(x - 5, y - 5, 10, 10)
        } else {
          previousPoint = { x, y }
        }
      }

      canvas.onmousemove = function (e) {
        const x = e.clientX
        const y = e.clientY
        if (!isUsing) return
        if (eraserEnabled) {
          context.clearRect(x - 5, y - 5, 10, 10)
        } else {
          const currentPoint = { x, y }
          drawLine(previousPoint.x, previousPoint.y, currentPoint.x, currentPoint.y, 5)
          previousPoint = currentPoint
        }
      }

      canvas.onmouseup = function () {
        isUsing = false
      }
    }


    eraser.onclick = function () {
      eraserEnabled = !eraserEnabled
    }
  }


  function drawLine(x1, y1, x2, y2, width) {
    context.beginPath()
    context.strokeStyle = 'black'
    context.moveTo(x1, y1)
    context.lineWidth = width
    context.lineTo(x2, y2)
    context.stroke()
    context.closePath()
  }


  function autoSetCanvasSize(canvas) {
    function setCanvasSize() {
      const pageWidth = document.documentElement.clientWidth
      const pageHeight = document.documentElement.clientHeight
      canvas.setAttribute('width', pageWidth.toString())
      canvas.setAttribute('height', pageHeight.toString())
    }
    setCanvasSize()
    window.onresize = function () {
      setCanvasSize()
    }
  }




</script>
</body>
</html>